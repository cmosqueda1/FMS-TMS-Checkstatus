<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pro Status Check: FMS vs TMS</title>

<style>
  :root{
    --bg:#0a0c10;--card:#0f1420;--text:#e6edf6;--muted:#93a4b7;
    --accent:#7c3aed;--accent2:#22d3ee;--ok:#10b981;--bad:#ef4444;--border:#1f2a3a;
  }
  html,body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:Inter,system-ui,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
  }
  .wrap{max-width:980px;margin:40px auto;padding:0 16px 64px}
  .card{
    background:var(--card);border:1px solid var(--border);
    border-radius:18px;padding:18px;
  }

  textarea{
    width:100%;min-height:200px;background:#0b0f19;border:1px solid var(--border);
    color:var(--text);border-radius:14px;padding:12px 14px;
    font-size:14px;line-height:1.4;resize:vertical;outline:none
  }

  pre {
    white-space: pre;
    font-family: Consolas, "Cascadia Mono", "Fira Code", monospace;
    background:#0b0f19;
    border:1px solid var(--border);
    border-radius:14px;
    padding:12px;
    font-size:13px;
    max-height:420px;
    overflow:auto;
  }

  .mode-btn{
    padding:10px 18px;border-radius:10px;border:1px solid var(--border);
    background:#0b0f19;color:var(--text);
  }
  .mode-btn.active{
    background:linear-gradient(90deg,var(--accent),var(--accent2));
    color:#060913;border-color:transparent;
  }

</style>
</head>

<body>
<div class="wrap">
  <h1>Pro Status Check: FMS vs TMS</h1>

  <div class="card">
    <div style="margin-bottom:10px; display:flex; gap:6px;">
      <button id="modePro" class="mode-btn active">Search Pro</button>
      <button id="modePU" class="mode-btn">Search PU</button>
    </div>

    <textarea id="input"></textarea>

    <div style="display:flex; justify-content:space-between; margin-top:6px">
      <div id="proMeta" class="muted">0 entries detected</div>
      <div id="status" class="muted">Idle</div>
    </div>

    <div style="margin-top:12px; display:flex; gap:10px;">
      <button class="mode-btn" id="run">Check Status</button>
      <button class="mode-btn" id="export">Export Results (.csv)</button>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <strong>Output</strong>
    <pre id="out"></pre>
  </div>
</div>

<script>
const PREFIX_WIDTH = 11;

const COL = {
  pro: 14,
  pu: 14,
  DO: 14,
  loc: 16,
  status: 35,
  sub: 40
};

const $ = id => document.getElementById(id);
let currentMode = "pro";
const out = $("out");

function pad(val, width){
  val = String(val ?? "-");
  return val + " ".repeat(Math.max(0, width - val.length));
}

function prefixBlock(prefix){
  const txt = prefix + ":";
  return txt + " ".repeat(Math.max(0, PREFIX_WIDTH - txt.length));
}

function line(msg){
  out.textContent += (out.textContent ? "\n" : "") + msg;
}

function parseInput(text){
  return (String(text).match(/\b\d{4,14}\b/g) || []);
}

$("modePro").addEventListener("click",()=>{
  currentMode="pro";
  $("modePro").classList.add("active");
  $("modePU").classList.remove("active");
});
$("modePU").addEventListener("click",()=>{
  currentMode="pu";
  $("modePU").classList.add("active");
  $("modePro").classList.remove("active");
});

$("input").addEventListener("input",()=>{
  $("proMeta").textContent = `${parseInput($("input").value).length} entries detected`;
});

async function runLookup(){
  out.textContent="";
  const values = parseInput($("input").value);
  if(!values.length){
    line("[Error] No input values found.");
    return;
  }

  const endpoint = currentMode==="pu" ? "/api/check-status-pu" : "/api/check-status-pro";
  const resp = await fetch(endpoint,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(currentMode==="pu" ? { pu_nos: values } : { pros: values })
  });

  const data = await resp.json();
  const results = data.results || [];

  results.forEach((r,i)=>{
    const row = {
      pro: r.pro || "-",
      pu: r.pu || "-",
      DO: r.fms?.DO || "-",
      loc: r.fms?.loc || "-",
      status: r.fms?.status || "-",
      sub: r.fms?.substatus || "-"
    };

    const trow = {
      pro: r.pro || "-",
      pu: r.pu || "-",
      orderId: r.tms?.orderId || "-",
      loc: r.tms?.loc || "-",
      status: r.tms?.status || "-",
      sub: r.tms?.substatus || "-"
    };

    // Build prefix padded
    const prefF = prefixBlock("FMS") + " ";
    const prefT = prefixBlock("TMS") + " ";

    if(!r.fms?.hasDO){
      line(prefF + `no FMS record found for this ${currentMode.toUpperCase()}`);
    } else {
      line(
        prefF +
        `${pad("PRO  " + row.pro, COL.pro + 5)}   |   ${pad("PU  " + row.pu, COL.pu + 5)}   ->   ${pad(row.DO, COL.DO)}   |   ${pad("Status  " + row.status, COL.status + 8)}   |   ${pad("Substatus  " + row.sub, COL.sub + 11)}`
      );
    }

    if(r.tms?.notFound){
      line(prefT + `no TMS record found for this ${currentMode.toUpperCase()}`);
    } else {
      line(
        prefT +
        `${pad("PRO  " + trow.pro, COL.pro + 5)}   |   ${pad("PU  " + trow.pu, COL.pu + 5)}   ->   ${pad("OrderID " + trow.orderId, COL.DO + 9)}   |   ${pad("Status  " + trow.status, COL.status + 8)}   |   ${pad("Substatus  " + trow.sub, COL.sub + 11)}`
      );
    }

    if(i < results.length-1) line("");
  });
}

$("run").addEventListener("click", runLookup);
</script>

</body>
</html>
